[tox]
envlist = main, dev
isolated_build = True
skip_missing_interpreters = False

[testenv]
deps = 
    pytest
    numpy
    matplotlib
    stim
    pymatching
    python-igraph
    statsmodels

[testenv:main]
description = Test against main branch (original implementation)
allowlist_externals = git
commands_pre =
    git worktree add --detach ../_main origin/main
    pip install -q ../_main
commands = 
    pytest -xvs tests/test_circuit_equivalence/test_main_branch.py --tb=short
commands_post =
    git worktree remove ../_main --force

[testenv:dev]  
description = Test against dev branch (refactored implementation)
commands =
    pip install -q -e .
    pytest -xvs tests/test_circuit_equivalence/test_dev_branch.py --tb=short

[testenv:compare]
description = Compare results between main and dev branches
deps = 
    {[testenv]deps}
commands =
    pip install -q -e .
    python tests/test_circuit_equivalence/compare_results.py

[testenv:full]
description = Run complete verification pipeline
allowlist_externals = git
commands_pre =
    git worktree add --detach ../_main origin/main
    pip install -q ../_main
    pytest -xvs tests/test_circuit_equivalence/test_main_branch.py --tb=short
    pip uninstall -y color-code-stim
    pip install -q -e .
commands = 
    pytest -xvs tests/test_circuit_equivalence/test_dev_branch.py --tb=short
    python tests/test_circuit_equivalence/compare_results.py
commands_post =
    git worktree remove ../_main --force